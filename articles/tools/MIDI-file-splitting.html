<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>MIDI file splitting | DryWetMIDI </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="MIDI file splitting | DryWetMIDI ">
    <meta name="generator" content="docfx 2.59.2.0">
    
    <link rel="shortcut icon" href="../../images/favicon.png">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../images/logo.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="a_file_splitting">
<h1 id="midi-file-splitting">MIDI file splitting</h1>

<p>You can split a MIDI file in different ways using extension methods from the <a href="xref:Melanchall.DryWetMidi.Tools.Splitter">Splitter</a> class. Available methods are described below. Please note that the article doesn't cover all possible methods and their settings. Please read API documentation on <a href="xref:Melanchall.DryWetMidi.Tools.Splitter">Splitter</a> to get complete information.</p>
<h2 id="splitbychannel">SplitByChannel</h2>
<p><a href="xref:Melanchall.DryWetMidi.Tools.Splitter.SplitByChannel*">SplitByChannel</a> method splits a MIDI file by channel so all <a href="xref:Melanchall.DryWetMidi.Core.ChannelEvent">channel events</a> will be separated by channel and copied to corresponding new files. All meta and system exclusive events will be copied to all the new files (that's default behavior that can be turned off). Thus each new file will contain all meta and sysex events and channel ones for a single channel. The image below illustrates this process:</p>
<p><img src="images/Splitter/SplitByChannel.png" alt="Split MIDI file by channel"></p>
<h2 id="splitbyobjects">SplitByObjects</h2>
<p><a href="xref:Melanchall.DryWetMidi.Tools.Splitter.SplitByObjects*">SplitByObjects</a> method splits a MIDI file by objects. The process can be adjusted via <a href="xref:Melanchall.DryWetMidi.Tools.SplitByObjectsSettings">SplitByObjectsSettings</a> passed to the second parameter of the method.</p>
<p>For example, to split a file by notes copying all MIDI events to each new file:</p>
<pre><code class="lang-csharp">var newFiles = midiFile.SplitByObjects(
    ObjectType.Note | ObjectType.TimedEvent,
    new SplitByObjectsSettings
    {
        WriteToAllFilesPredicate = obj =&gt; obj is TimedEvent
    });
</code></pre>
<p>Here we specify that we need to split the file by notes and timed events, but every timed event must be written to all result files. So in fact we're splitting the file by notes having all non-notes timed events presented in each new file. The image below illustrates the process:</p>
<p><img src="images/Splitter/SplitByObjects.png" alt="Split MIDI file by objects"></p>
<p>To split a file by objects the tool needs to determine the key of each object. Objects with the same key will be outputted in a separate file. In the example above default logic of key calculation is used. The following table shows what a default key is for each type of an object:</p>
<table>
<thead>
<tr>
<th>Object type</th>
<th>Key</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="xref:Melanchall.DryWetMidi.Interaction.ObjectType.TimedEvent">TimedEvent</a></td>
<td>The type of the underlying event (<a href="xref:Melanchall.DryWetMidi.Core.MidiEvent.EventType">EventType</a> of <a href="xref:Melanchall.DryWetMidi.Interaction.TimedEvent.Event">TimedEvent.Event</a>).</td>
</tr>
<tr>
<td><a href="xref:Melanchall.DryWetMidi.Interaction.ObjectType.Note">Note</a></td>
<td>Pair of the <a href="xref:Melanchall.DryWetMidi.Interaction.Note.Channel">channel</a> and <a href="xref:Melanchall.DryWetMidi.Interaction.Note.NoteNumber">note number</a> of a note.</td>
</tr>
<tr>
<td><a href="xref:Melanchall.DryWetMidi.Interaction.ObjectType.Chord">Chord</a></td>
<td>Collection of keys of the underlying <a href="xref:Melanchall.DryWetMidi.Interaction.Chord.Notes">notes</a>.</td>
</tr>
<tr>
<td><a href="xref:Melanchall.DryWetMidi.Interaction.ObjectType.Rest">Rest</a></td>
<td>Pair of the <a href="xref:Melanchall.DryWetMidi.Interaction.Rest.Channel">channel</a> and <a href="xref:Melanchall.DryWetMidi.Interaction.Rest.NoteNumber">note number</a> of a rest.</td>
</tr>
</tbody>
</table>
<p>You can alter key calculation logic providing custom key selector. For example, to separate notes by only note number ignoring a note's channel:</p>
<pre><code class="lang-csharp">var newFiles = midiFile.SplitByObjects(
    ObjectType.Note | ObjectType.TimedEvent,
    new SplitByObjectsSettings
    {
        KeySelector = obj =&gt; obj is Note note
            ? ObjectIdUtilities.GetObjectId(note.NoteNumber)
            : obj.GetObjectId(),
        WriteToAllFilesPredicate = obj =&gt; obj is TimedEvent
    });
</code></pre>
<p><a href="xref:Melanchall.DryWetMidi.Interaction.ObjectIdUtilities.GetObjectId%60%601(%60%600)">ObjectIdUtilities.GetObjectId(value)</a> returns an implementation of <a href="xref:Melanchall.DryWetMidi.Interaction.IObjectId">IObjectId</a> which simply holds the provided value. <a href="xref:Melanchall.DryWetMidi.Interaction.ObjectIdUtilities.GetObjectId(Melanchall.DryWetMidi.Interaction.ITimedObject)">ObjectIdUtilities.GetObjectId(object)</a> returns the default ID (key) for an object. So if an object is a note, we use its note number as the key; and default key for any other object types.</p>
<p>If custom logic of key selection is complex, you may decide to implement the <a href="xref:Melanchall.DryWetMidi.Interaction.IObjectId">IObjectId</a> interface and return that implementation. Just for example, let's create an ID class that identifies a chord by its shortest name:</p>
<pre><code class="lang-csharp">private sealed class ChordNameId : IObjectId
{
    private readonly string _name;
    
    public ChordNameId(Chord chord)
    {
        _name = chord.GetMusicTheoryChord().GetNames().FirstOrDefault();
    }

    public override bool Equals(object obj) =&gt;
        obj is ChordNameId chordNameId &amp;&amp;
        chordNameId._name == _name;

    public override int GetHashCode() =&gt;
        _name.GetHashCode();
}
</code></pre>
<p>And now we can use it to split a file by chords of the same name:</p>
<pre><code class="lang-csharp">var newFiles = midiFile.SplitByObjects(
    ObjectType.Chord,
    new SplitByObjectsSettings
    {
        KeySelector = obj =&gt; new ChordNameId((Chord)obj)
    });
</code></pre>
<p>Please see documentation on <a href="xref:Melanchall.DryWetMidi.Tools.SplitByObjectsSettings">SplitByObjectsSettings</a> to learn more about how you can adjust the process of splitting.</p>
<h2 id="splitbygrid">SplitByGrid</h2>
<p><a href="xref:Melanchall.DryWetMidi.Tools.Splitter.SplitByGrid*">SplitByGrid</a> method splits MIDI file by the specified grid. Each file will preserve original tempo map and all parameters changes (like a control value or program changes). The image below shows general case of splitting a MIDI file by grid:</p>
<p><img src="images/Splitter/SplitFileByGrid.png" alt="Split MIDI file by grid"></p>
<p>Splitting can be adjusted via <code>settings</code> parameter of the <a href="xref:Melanchall.DryWetMidi.Tools.SliceMidiFileSettings">SliceMidiFileSettings</a> type. <a href="xref:Melanchall.DryWetMidi.Tools.SliceMidiFileSettings.SplitNotes">SplitNotes</a> and <a href="xref:Melanchall.DryWetMidi.Tools.SliceMidiFileSettings.PreserveTimes">PreserveTimes</a> properties described below. Please see all available properties in documentation for <a href="xref:Melanchall.DryWetMidi.Tools.SliceMidiFileSettings">SliceMidiFileSettings</a>.</p>
<h3 id="splitnotes">SplitNotes</h3>
<p><a href="xref:Melanchall.DryWetMidi.Tools.SliceMidiFileSettings.SplitNotes">SplitNotes</a> indicates whether notes should be split at points of grid intersection or not. The default value is <code>true</code>. If <code>false</code> used, notes treated as just Note On / Note Off events rather than note objects. Splitting notes produces new Note On / Note Off events at points where grid intersects notes if the property set to <code>true</code>. The following image shows splitting by grid if <code>SplitNotes</code> set to <code>false</code>:</p>
<p><img src="images/Splitter/SplitByGridDontSplitNotes.png" alt="Split MIDI file by grid without splitting notes"></p>
<h3 id="preservetimes">PreserveTimes</h3>
<p><a href="xref:Melanchall.DryWetMidi.Tools.SliceMidiFileSettings.PreserveTimes">PreserveTimes</a> indicates whether original times of events should be preserved or not. The default value is <code>false</code>. If <code>false</code> used, events will be moved to the start of a new file. If <code>true</code> used, events will be placed in new files at the same times as in the input file. The following image shows splitting in case of <code>PreserveTimes</code> set to <code>true</code>:</p>
<p><img src="images/Splitter/SplitByGridPreserveTimes.png" alt="Split MIDI file by grid preserving times"></p>
<h2 id="skippart">SkipPart</h2>
<p><a href="xref:Melanchall.DryWetMidi.Tools.Splitter.SkipPart*">SkipPart</a> method skips part of the specified length of a MIDI file and returns remaining part as an instance of <a href="xref:Melanchall.DryWetMidi.Core.MidiFile">MidiFile</a>. The image below shows general case of skipping a part of a MIDI file:</p>
<p><img src="images/Splitter/SkipPart.png" alt="Skip part of a MIDI file"></p>
<h2 id="takepart">TakePart</h2>
<p><a href="xref:Melanchall.DryWetMidi.Tools.Splitter.TakePart*">TakePart</a> methods take part of the specified length of a MIDI file (starting at the start or at the specified time within the file) and return it as an instance of <a href="xref:Melanchall.DryWetMidi.Core.MidiFile">MidiFile</a>. The image below shows both cases of taking a part of a MIDI file:</p>
<p><img src="images/Splitter/TakePartAtStart.png" alt="Take part of a MIDI file at the start of the file"></p>
<p><img src="images/Splitter/TakePartAtMiddle.png" alt="Take part of a MIDI file at the middle of the file"></p>
<h2 id="cutpart">CutPart</h2>
<p><a href="xref:Melanchall.DryWetMidi.Tools.Splitter.CutPart*">CutPart</a> method cuts a part of the specified length from a MIDI file (starting at the specified time within the file) and returns a new instance of <a href="xref:Melanchall.DryWetMidi.Core.MidiFile">MidiFile</a> which is the original file without the part. The image below shows how the method works:</p>
<p><img src="images/Splitter/CutPart.png" alt="Cut part from a MIDI file"></p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            2022 / Generated by <a href="https://dotnet.github.io/docfx">DocFX</a>
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
