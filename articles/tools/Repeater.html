<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Repeater | DryWetMIDI </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Repeater | DryWetMIDI ">
    <meta name="generator" content="docfx 2.59.2.0">
    
    <link rel="shortcut icon" href="../../images/favicon.png">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../images/logo.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="a_repeater">
<h1 id="repeater">Repeater</h1>

<p>With DryWetMIDI you can easily repeat groups of objects or entire MIDI files using the dedicated tool - <a class="xref" href="../../api/Melanchall.DryWetMidi.Tools.Repeater.html">Repeater</a>. Quick example of repeating a group of different objects two times:</p>
<p><img src="images/Repeater/Repeat.png" alt="Objects repeating"></p>
<p>It's a simple case. To calculate the distance to move each new part by, the tool looks at the value of the <a class="xref" href="../../api/Melanchall.DryWetMidi.Tools.RepeatingSettings.html#Melanchall_DryWetMidi_Tools_RepeatingSettings_ShiftPolicy">ShiftPolicy</a> property of the settings passed to <a class="xref" href="../../api/Melanchall.DryWetMidi.Tools.Repeater.html#Melanchall_DryWetMidi_Tools_Repeater_Repeat_">Repeat</a> methods. The default value is <a class="xref" href="../../api/Melanchall.DryWetMidi.Tools.ShiftPolicy.html#Melanchall_DryWetMidi_Tools_ShiftPolicy_ShiftByMaxTime">ShiftPolicy.ShiftByMaxTime</a> and you can see how this options works on the image above - the tool takes maximum time among all objects and shifts objects within each new part by this value.</p>
<p>But you can use fixed value to shift objects by. You need to specify <a class="xref" href="../../api/Melanchall.DryWetMidi.Tools.ShiftPolicy.html#Melanchall_DryWetMidi_Tools_ShiftPolicy_ShiftByFixedValue">ShiftPolicy.ShiftByFixedValue</a> for shift policy and set <a class="xref" href="../../api/Melanchall.DryWetMidi.Tools.RepeatingSettings.html#Melanchall_DryWetMidi_Tools_RepeatingSettings_Shift">Shift</a> property of the settings. So times of objects won't affect distance calculation now and data will be shifted by the value of the <code>Shift</code> property:</p>
<pre><code class="lang-csharp">var newFile = midiFile.Repeat(2, new RepeatingSettings
{
    ShiftPolicy = ShiftPolicy.ShiftByFixedValue,
    Shift = new MetricTimeSpan(0, 0, 10)
});
</code></pre>
<p><img src="images/Repeater/ShiftByFixedValue.png" alt="Shift objects by fixed value"></p>
<p>Also <a class="xref" href="../../api/Melanchall.DryWetMidi.Tools.RepeatingSettings.html">RepeatingSettings</a> class provides options to round shift value (calculated by max time or constant one). It can be useful, for example, when objects are not aligned with the grid. Please take a look at the following image:</p>
<p><img src="images/Repeater/RoundingUp.png" alt="Round shift up"></p>
<p>Here the data doesn't reach bar line time, but we want to repeat the objects with aligning to bars lines. Obviously we can't use <a class="xref" href="../../api/Melanchall.DryWetMidi.Tools.ShiftPolicy.html#Melanchall_DryWetMidi_Tools_ShiftPolicy_ShiftByMaxTime">ShiftPolicy.ShiftByMaxTime</a> option here. But we can't use <a class="xref" href="../../api/Melanchall.DryWetMidi.Tools.ShiftPolicy.html#Melanchall_DryWetMidi_Tools_ShiftPolicy_ShiftByFixedValue">ShiftPolicy.ShiftByFixedValue</a> too because we don't know the length of data in general case. We just want to repeat the objects and be sure the start of the objects group is always on a bar line. So we can write this code:</p>
<pre><code class="lang-csharp">var newFile = midiFile.Repeat(2, new RepeatingSettings
{
    ShiftPolicy = ShiftPolicy.ShiftByMaxTime,
    ShiftRoundingPolicy = TimeSpanRoundingPolicy.RoundUp,
    ShiftRoundingStep = new BarBeatTicksTimeSpan(1)
});
</code></pre>
<p>We tell the tool here to round calculated shift value up using the step of <code>1</code> bar. By default <a class="xref" href="../../api/Melanchall.DryWetMidi.Tools.RepeatingSettings.html#Melanchall_DryWetMidi_Tools_RepeatingSettings_ShiftRoundingPolicy">ShiftRoundingPolicy</a> property is set to <a class="xref" href="../../api/Melanchall.DryWetMidi.Interaction.TimeSpanRoundingPolicy.html#Melanchall_DryWetMidi_Interaction_TimeSpanRoundingPolicy_NoRounding">TimeSpanRoundingPolicy.NoRounding</a> but you can also set it <a class="xref" href="../../api/Melanchall.DryWetMidi.Interaction.TimeSpanRoundingPolicy.html#Melanchall_DryWetMidi_Interaction_TimeSpanRoundingPolicy_RoundDown">TimeSpanRoundingPolicy.RoundDown</a> along with <a class="xref" href="../../api/Melanchall.DryWetMidi.Interaction.TimeSpanRoundingPolicy.html#Melanchall_DryWetMidi_Interaction_TimeSpanRoundingPolicy_RoundUp">TimeSpanRoundingPolicy.RoundUp</a> shown above. Please see documentation on <a class="xref" href="../../api/Melanchall.DryWetMidi.Interaction.TimeSpanRoundingPolicy.html">TimeSpanRoundingPolicy</a> to learn more about rounding.</p>
<h2 id="custom-repeater">Custom repeater</h2>
<p>You can derive from the <a class="xref" href="../../api/Melanchall.DryWetMidi.Tools.Repeater.html">Repeater</a> class to make your own repeating logic. Let's imagine we want to repeat all notes transposing each repeated note by three semitones up and shifting it by <code>1/4</code> forward. So we need to skip non-note events and disable automatic shifting. The following image illustrates what we want to achieve:</p>
<p><img src="images/Repeater/CustomRepeater.png" alt="Custom repeater"></p>
<p>Well, our custom repeater class will be:</p>
<pre><code class="lang-csharp">private sealed class CustomRepeater : Repeater
{
    protected override void ProcessPart(PartProcessingContext context)
    {
        base.ProcessPart(context);

        var newObjects = context
            .PartObjects
            .Where(obj =&gt; ((TimedEvent)obj).Event is NoteEvent)
            .ToArray();

        context.PartObjects.Clear();

        foreach (var obj in newObjects)
        {
            ((NoteEvent)((TimedEvent)obj).Event).NoteNumber += (SevenBitNumber)((context.PartIndex + 1) * 3);

            var originalTime = obj.TimeAs&lt;MusicalTimeSpan&gt;(context.SourceTempoMap);
            obj.SetTime(
                originalTime.Add(MusicalTimeSpan.Quarter * (context.PartIndex + 1), TimeSpanMode.TimeLength),
                context.SourceTempoMap);
            
            context.PartObjects.Add(obj);
        }
    }
}
</code></pre>
<p>And we will use it in this way:</p>
<pre><code class="lang-csharp">var newFile = new CustomRepeater().Repeat(midiFile, 3, new RepeatingSettings
{
    ShiftPolicy = ShiftPolicy.None
});
</code></pre>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            2022 / Generated by <a href="https://dotnet.github.io/docfx">DocFX</a>
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
